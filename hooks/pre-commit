#!/bin/bash
echo "Secretlintで認証情報チェック中..."

SCRIPT_DIR="$(dirname "$0")"
CONFIG_FILE="$SCRIPT_DIR/secretlintrc.json"

if [ ! -f "$CONFIG_FILE" ]; then
    echo "❌ 設定ファイルが見つかりません: $CONFIG_FILE"
    exit 1
fi

echo "共通ルールを使用: $CONFIG_FILE"

docker run \
  -v "$(pwd)":"$(pwd)" \
  -v "$CONFIG_FILE":"$CONFIG_FILE":ro \
  -w "$(pwd)" \
  --rm \
  secretlint/secretlint \
  secretlint "**/*" --secretlintrc "$CONFIG_FILE"

if [ $? -ne 0 ]; then
    echo "❌ シークレット情報が検出されました！"
    echo "修正してから再度コミットしてください。"
    exit 1
fi

echo "✅ チェック完了：問題ありません"
